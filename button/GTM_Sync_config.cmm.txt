

LOCAL &portTC0 &portGTM &addressTC0 &addressGTM

GOSUB setup_intercom
ON CMD COREGTM GOSUB coreGTM

ON CMD CORETC0 GOSUB coreTC0
ON CMD COREGTM GOSUB coreGTM

COREGTM RESet
CORETC0 RESet
CORETC0 SYStem.Up
COREGTM SYStem.Mode Attach
COREGTM Break

; ; set up synchronization between GUIs
; CORETC0 SYStem.Option PERSTOP ON //needs to be enabled, GTM acts as periphery
; CORETC0 SYnch.Connect &addressGTM
; COREGTM SYnch.Connect &addressTC0
; CORETC0 SYnch.MasterBreak ON // required
; COREGTM SYnch.SlaveBreak ON  // required
; CORETC0 SYnch.MasterGo ON    // optional, also served by PERSTOP
; COREGTM SYnch.SlaveGo ON     // optional, also served by PERSTOP

setup_intercom:
(
  &portTC0=FORMAT.DECIMAL(1.,INTERCOM.PORT())
  &portGTM=FORMAT.DECIMAL(1.,INTERCOM.PORT()+1.)
  &addressTC0="127.0.0.1:&portTC0"
  &addressGTM="127.0.0.1:&portGTM"
  RETURN
)
coreGTM:
(
  LOCAL &params
  ENTRY %Line &params
  INTERCOM.execute &addressGTM &params ; execute on remote GUI
  RETURN
)
coreTC0:
(
  LOCAL &params
  ENTRY %Line &params
  &params ; execute on this GUI
  RETURN
)